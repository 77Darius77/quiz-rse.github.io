<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz LACM√â: Pr√™ts pour la transition ?</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chargement de la police Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* D√©finition de la police Inter comme police par d√©faut */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Style pour les options coch√©es (cases √† cocher) */
        .option-selected {
            background-color: #DBEAFE !important;
            /* bg-blue-100 */
            border-color: #3B82F6 !important;
            /* border-blue-500 */
        }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden">

        <!-- Modale Email Existant -->
        <div id="email-modal"
            class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-6">
                    <svg class="h-10 w-10 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-4">Adresse d√©j√† utilis√©e</h3>
                <p class="text-gray-600 mb-8">D√©sol√©, mais cette adresse a d√©j√† √©t√© utilis√©e pour participer au quiz.
                </p>
                <button onclick="closeApp()"
                    class="w-full bg-gray-800 text-white font-bold py-3 px-4 rounded-lg text-lg hover:bg-gray-900 transition-all shadow-lg focus:outline-none focus:ring-4 focus:ring-gray-300">
                    Au revoir
                </button>
            </div>
        </div>

        <!-- √âcran d'Introduction -->
        <div id="intro-screen" class="p-8 sm:p-12 text-center">
            <!-- Logo LACM√â -->
            <img src="https://cheval-partenaire.fr/wp-content/uploads/2017/11/lacme_logo-1024x153.png" alt="Logo LACM√â"
                class="mx-auto mb-6 max-h-20 sm:max-h-24 object-contain">

            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800 mb-4">Quiz LACM√â: Pr√™ts pour la transition ?</h1>
            <p class="text-lg text-gray-700 mb-4">
                Bienvenue √† vous cher collaborateur de LACM√â ! üëã
            </p>
            <p class="text-lg text-gray-700 mb-6">
                Ce quiz ludique est une excellente occasion de tester vos connaissances sur les enjeux
                environnementaux et de d√©couvrir les **actions concr√®tes** r√©alis√©es par notre entreprise en 2024.
            </p>
            <p class="text-base text-gray-600 mb-6 font-medium">
                Attention : pour certaines questions, plusieurs r√©ponses peuvent √™tre exactes. Cochez-les toutes pour
                marquer plus de points ! üòâ
            </p>

            <!-- Formulaire d'Email -->
            <form id="email-form" class="mt-8 text-left max-w-md mx-auto">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="prenom" class="block text-sm font-medium text-gray-700 mb-2">Pr√©nom :</label>
                        <input type="text" id="prenom-input" name="prenom"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Votre pr√©nom" required>
                    </div>
                    <div>
                        <label for="nom" class="block text-sm font-medium text-gray-700 mb-2">Nom :</label>
                        <input type="text" id="nom-input" name="nom"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Votre nom" required>
                    </div>
                </div>

                <div class="mt-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email :</label>
                    <input type="email" id="email-input" name="email"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="votre.email@lacme.com" required>
                </div>

                <p id="email-error" class="text-red-600 text-sm mt-2 hidden">Veuillez remplir tous les champs (email
                    valide).</p>

                <button id="start-btn" type="submit"
                    class="w-full mt-6 bg-blue-600 text-white font-bold py-3 px-12 rounded-lg text-lg hover:bg-blue-700 transition-all shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300">
                    Lan√ßons le d√©fi !
                </button>
            </form>

        </div>

        <!-- √âcran du Quiz -->
        <div id="quiz-screen" class="hidden p-8 sm:p-12">
            <!-- Barre de progression -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span id="question-counter" class="text-sm font-medium text-blue-700">Question 1 / 10</span>
                    <span id="current-score" class="text-sm font-medium text-gray-600">Score: 0</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300"
                        style="width: 10%"></div>
                </div>
            </div>

            <!-- Contenu de la question -->
            <div class="mb-4 min-h-[100px]">
                <p id="question-text" class="text-xl sm:text-2xl font-semibold text-gray-900">Chargement de la
                    question...</p>
                <p id="multi-select-hint" class="text-sm text-gray-500 italic mt-2 hidden">Plusieurs r√©ponses sont
                    possibles !</p>
            </div>

            <!-- Options de r√©ponse -->
            <div id="options-container" class="grid grid-cols-1 gap-4">
                <!-- Les options seront inject√©es ici par JS -->
            </div>

            <!-- Bouton de validation (pour les cases √† cocher) --><button id="validate-btn"
                class="hidden w-full mt-6 bg-green-600 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-green-700 transition-all shadow-lg focus:outline-none focus:ring-4 focus:ring-green-300">
                Valider mes r√©ponses
            </button>

            <!-- Feedback -->
            <div id="feedback-container" class="hidden mt-6 p-5 rounded-lg">
                <div class="flex items-start">
                    <div id="feedback-icon" class="flex-shrink-0">
                        <!-- SVG (check ou X) inject√© par JS -->
                    </div>
                    <div class="ml-4">
                        <h3 id="feedback-title" class="text-lg font-bold"></h3>
                        <p id="feedback-text" class="mt-2 text-base"></p>
                        <button id="next-btn"
                            class="mt-4 bg-gray-800 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-900 transition-all focus:outline-none focus:ring-4 focus:ring-gray-300">
                            Question suivante
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âcran des R√©sultats -->
        <div id="results-screen" class="hidden p-8 sm:p-12 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800 mb-4">Quiz termin√© !</h1>
            <p class="text-lg text-gray-700 mb-6">Votre score final est de :</p>
            <div class="my-8">
                <span id="final-score" class="text-7xl font-bold text-blue-600">0</span>
                <span class="text-3xl font-semibold text-gray-500">/ 10</span>
            </div>
            <p id="final-message" class="text-lg text-gray-800 mb-10 px-4">Message de f√©licitations...</p>

            <p class="text-base text-gray-600 mb-2">
                Merci pour votre participation ! Chaque question est une √©tape de plus vers une entreprise plus
                responsable.
            </p>

            <!-- Statut de l'enregistrement -->
            <p id="submit-status" class="text-sm text-gray-500 mb-8 italic">Enregistrement de votre score...</p>

            <button id="quit-btn" onclick="closeApp()"
                class="w-full sm:w-auto bg-gray-800 text-white font-bold py-3 px-12 rounded-lg text-lg hover:bg-gray-900 transition-all shadow-lg focus:outline-none focus:ring-4 focus:ring-gray-300">
                Au revoir
            </button>
        </div>

    </div>

    <script>
        // --- IMPORTANT ---
        // Collez ici l'URL de votre Web App Google Apps Script
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxg0xpJMksniiklKHptUwvWewF2EXK8ApZ2-F-7LgTd4y-HfBlMlfphEtNwJJDeu90VmA/exec';
        // -----------------


        // --- Donn√©es du Quiz (Mises √† jour pour LACM√â 2024) ---
        const quizData = [
            {
                // Q1: G√©n√©ralit√© pour commencer
                question: "Au sein de notre PME, qui est (ou devrait √™tre) impliqu√© dans la transition √©cologique ?",
                type: "mc",
                options: [
                    "Uniquement la Direction, qui fixe la strat√©gie.",
                    "Seulement le responsable HSE / RSE.",
                    "Absolument tout le monde, de l'atelier au bureau."
                ],
                correct: [2],
                feedback: "C'est l'affaire de tous ! La transition √©cologique mobilise une grande diversit√© d'acteurs. Dans l'entreprise, chaque poste a un r√¥le √† jouer, des achats √† la production, en passant par l'administratif."
            },
            {
                // Q2: LACM√â Sp√©cifique - Surface Entrep√¥t
                question: "Le nouvel entrep√¥t logistique de LACM√â est une pi√®ce ma√Ætresse de notre strat√©gie. Quelle est sa surface totale ?",
                type: "mc",
                options: [
                    "2 400 m¬≤",
                    "6 000 m¬≤",
                    "10 000 m¬≤"
                ],
                correct: [1],
                feedback: "Exactement ! Ce b√¢timent de 6 000 m¬≤ n'est pas qu'une zone de stockage : il a √©t√© con√ßu pour √™tre autonome en √©nergie gr√¢ce √† sa toiture solaire."
            },
            {
                // Q3: LACM√â Sp√©cifique - Panneaux Solaires
                question: "Pour assurer l'autonomie √©nerg√©tique de ce nouvel entrep√¥t, combien de panneaux photovolta√Øques ont √©t√© install√©s sur le toit ?",
                type: "mc",
                options: [
                    "Environ 500 panneaux",
                    "1 084 panneaux",
                    "2 400 panneaux"
                ],
                correct: [1],
                feedback: "C'est pr√©cis ! 1 084 panneaux couvrent 2 400 m¬≤ de toiture. Cet investissement doit nous permettre de couvrir pr√®s de 50% des besoins en √©lectricit√© de tout le site d'ici 2026."
            },
            {
                // Q4: G√©n√©ralit√© RSE
                question: "Pourquoi la lutte contre le r√©chauffement climatique doit-elle se faire √† la fois localement (chez nous) et globalement ?",
                type: "cb",
                options: [
                    "Parce que le climat est un \"bien commun\" mondial.",
                    "Parce que les actions locales (ex: isoler un b√¢timent) et globales sont compl√©mentaires.",
                    "Parce que l'√©chelle locale est la seule qui compte vraiment.",
                    "Parce que l'√©chelle globale est trop lente et inefficace."
                ],
                correct: [0, 1],
                feedback: "Tout √† fait ! Le climat est un bien commun qui ne conna√Æt pas les fronti√®res. Les actions locales (isolation, tri, panneaux solaires) sont essentielles, mais elles doivent √™tre coordonn√©es pour √™tre pleinement efficaces."
            },
            {
                // Q5: LACM√â Sp√©cifique - D√©chets (Nuance 85% vs 58%)
                question: "En 2024, quelle part pr√©cise de nos d√©chets a trouv√© une v√©ritable 'seconde vie' (recyclage mati√®re ou surcyclage) ?",
                type: "mc",
                options: [
                    "30 %",
                    "58 %",
                    "85 %"
                ],
                correct: [1],
                feedback: "Bien jou√© ! La nuance est importante : 85% de nos d√©chets sont 'valoris√©s' (ce qui inclut la valorisation √©nerg√©tique, donc destruction), mais 58% sont r√©ellement 'recycl√©s' pour redevenir de la mati√®re."
            },
            {
                // Q6: LACM√â Sp√©cifique - Sant√© / CMR
                question: "C√¥t√© sant√© et s√©curit√© au travail, quelle avanc√©e majeure a √©t√© r√©alis√©e dans l'atelier r√©sinage en 2024 ?",
                type: "mc",
                options: [
                    "L'√©limination totale des substances CMR (Canc√©rog√®nes, Mutag√®nes, Reprotoxiques).",
                    "L'installation de la climatisation int√©grale.",
                    "La mise en place du t√©l√©travail pour les op√©rateurs."
                ],
                correct: [0],
                feedback: "C'est un engagement fort du rapport 2024 ! Le nouveau process supprime les CMR et r√©duit drastiquement les COV (Compos√©s Organiques Volatils), garantissant plus de s√©curit√© pour nos collaborateurs."
            },
            {
                // Q7: G√©n√©ralit√© RSE - Petits gestes
                question: "Les \"petits gestes\" individuels (trier ses d√©chets, √©teindre sa lumi√®re) sont-ils suffisants pour relever le d√©fi climatique ?",
                type: "mc",
                options: [
                    "Oui, si tout le monde s'y met, cela suffira.",
                    "Non, ils sont inutiles.",
                    "Non, ils sont INDISPENSABLES mais pas suffisants. Ils doivent √™tre compl√©t√©s par des actions collectives et industrielles."
                ],
                correct: [2],
                feedback: "C'est la r√©ponse la plus juste. Les gestes individuels cr√©ent une culture d'engagement, mais la transformation √©cologique n√©cessite aussi des investissements lourds comme ceux r√©alis√©s par LACM√â (b√¢timent, process)."
            },
            {
                // Q8: Contextuel PME Sarthe
                question: "En tant que PME en Sarthe, quelle action concr√®te a un impact significatif ?",
                type: "mc",
                options: [
                    "Remplacer les bouteilles plastiques.",
                    "Optimiser les tourn√©es de livraison.",
                    "Trier le papier et les d√©chets industriels.",
                    "Toutes ces actions sont utiles et leur impact combin√© est significatif."
                ],
                correct: [3],
                feedback: "Bravo ! C'est la somme de toutes ces actions qui fait la diff√©rence. L'optimisation logistique a un gros impact CO2, et la gestion des d√©chets (comme nos 58% recycl√©s) est cruciale."
            },
            {
                // Q9: Question bonus sur la mobilit√© (Mentionn√©e dans le PDF)
                question: "En 2024, LACM√â a int√©gr√© un v√©hicule utilitaire 100% √©lectrique pour sa logistique interne. Quel est le b√©n√©fice imm√©diat ?",
                type: "cb",
                options: [
                    "R√©duction des √©missions de CO2 sur le site.",
                    "Suppression de la pollution sonore.",
                    "Cela permet de rouler plus vite dans les all√©es.",
                    "√âlimination des gaz d'√©chappement dans les zones de travail."
                ],
                correct: [0, 1, 3],
                feedback: "Exactement ! Ce remplacement supprime les √©missions directes et le bruit, am√©liorant √† la fois le bilan carbone et le confort de travail sur le site."
            },
            {
                // Q10: Conclusion
                question: "Concr√®tement, la transition √©cologique pour une PME comme LACM√â, c'est surtout...",
                type: "mc",
                options: [
                    "Une source de co√ªts et de contraintes suppl√©mentaires.",
                    "Une contrainte r√©glementaire, mais aussi un levier d'innovation, d'√©conomies et d'attractivit√©.",
                    "Seulement une question d'image de marque."
                ],
                correct: [1],
                feedback: "C'est la vision moderne ! Si la transition demande des efforts, elle est aussi un formidable moteur pour innover (nouvel entrep√¥t), faire des √©conomies (√©nergie) et prot√©ger nos √©quipes (sant√©)."
            }
        ];

        // --- √âl√©ments du DOM ---
        const introScreen = document.getElementById('intro-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');

        const emailForm = document.getElementById('email-form');
        const emailInput = document.getElementById('email-input');
        const emailError = document.getElementById('email-error');
        const nomInput = document.getElementById('nom-input');
        const prenomInput = document.getElementById('prenom-input');

        const quitBtn = document.getElementById('quit-btn');
        const nextBtn = document.getElementById('next-btn');
        const validateBtn = document.getElementById('validate-btn');

        const questionCounter = document.getElementById('question-counter');
        const currentScoreEl = document.getElementById('current-score');
        const progressBar = document.getElementById('progress-bar');
        const questionText = document.getElementById('question-text');
        const multiSelectHint = document.getElementById('multi-select-hint');
        const optionsContainer = document.getElementById('options-container');

        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');

        const finalScore = document.getElementById('final-score');
        const finalMessage = document.getElementById('final-message');
        const submitStatus = document.getElementById('submit-status');

        // Ic√¥nes pour le feedback
        const checkIcon = `
            <svg class="h-8 w-8 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>`;
        const crossIcon = `
            <svg class="h-8 w-8 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>`;

        // --- √âtat du Quiz ---
        let currentQuestionIndex = 0;
        let score = 0;
        let userSelection = []; // Pour les questions √† choix multiples (cb)
        let userEmail = "";
        let userNom = "";
        let userPrenom = "";

        // --- Fonctions ---

        async function handleStartSubmit(event) {
            event.preventDefault();
            const email = emailInput.value.trim();
            const nom = nomInput.value.trim();
            const prenom = prenomInput.value.trim();

            if (email && email.includes('@') && nom && prenom) { // Validation simple
                userEmail = email;
                userNom = nom;
                userPrenom = prenom;
                emailError.classList.add('hidden');

                // V√©rification de l'email
                const startBtn = document.getElementById('start-btn');
                const originalText = startBtn.innerText;
                startBtn.innerText = "V√©rification...";
                startBtn.disabled = true;

                const formData = new FormData();
                formData.append('action', 'checkEmail');
                formData.append('email', userEmail);

                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.exists === true) {
                        // Afficher la modale de refus
                        document.getElementById('email-modal').classList.remove('hidden');
                    } else {
                        startQuiz();
                    }
                } catch (error) {
                    console.error("Erreur de v√©rification", error);
                    // Lan√ßons le quiz par d√©faut si erreur de r√©seau (ou script pas encore √† jour)
                    startQuiz();
                } finally {
                    startBtn.innerText = originalText;
                    startBtn.disabled = false;
                }

            } else {
                emailError.innerText = "Veuillez remplir tous les champs (email valide).";
                emailError.classList.remove('hidden');
            }
        }

        function closeApp() {
            // Essaie de fermer l'onglet
            window.close();
            // Fallback si le navigateur bloque window.close()
            document.body.innerHTML = '<div class="flex items-center justify-center min-h-screen"><h1 class="text-2xl font-bold text-gray-800 text-center px-4">Merci de votre participation. Vous pouvez maintenant fermer cet onglet.</h1></div>';
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userSelection = [];
            introScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            loadQuestion();
            updateScoreboard();
        }

        function loadQuestion() {
            // R√©initialiser
            userSelection = [];
            feedbackContainer.classList.add('hidden');
            validateBtn.classList.add('hidden');
            multiSelectHint.classList.add('hidden'); // Cacher l'indice par d√©faut
            optionsContainer.innerHTML = ''; // Vider les options pr√©c√©dentes

            const question = quizData[currentQuestionIndex];
            questionText.innerText = question.question;

            // Mise √† jour de la progression
            questionCounter.innerText = `Question ${currentQuestionIndex + 1} / ${quizData.length}`;
            progressBar.style.width = `${((currentQuestionIndex + 1) / quizData.length) * 100}%`;

            // Cr√©er les boutons d'option
            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.innerHTML = `<span class="font-medium">${option}</span>`;
                optionBtn.className = "w-full p-4 rounded-lg border-2 border-gray-300 text-gray-800 text-left transition-all duration-150 hover:bg-blue-50 hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-300";
                optionBtn.dataset.index = index;

                if (question.type === 'mc') {
                    optionBtn.onclick = () => selectAnswerMC(index, optionBtn);
                } else { // type === 'cb'
                    optionBtn.onclick = () => selectAnswerCB(index, optionBtn);
                }
                optionsContainer.appendChild(optionBtn);
            });

            // Afficher le bouton Valider et l'indice pour les 'cb'
            if (question.type === 'cb') {
                validateBtn.classList.remove('hidden');
                multiSelectHint.classList.remove('hidden');
            }
        }

        // S√©lection pour Choix Unique (MC)
        function selectAnswerMC(index) {
            const question = quizData[currentQuestionIndex];
            const isCorrect = question.correct[0] === index;

            if (isCorrect) {
                score++;
                updateScoreboard();
            }

            // D√©sactiver tous les boutons
            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-blue-50', 'hover:border-blue-400');
            });

            // Afficher le feedback
            showFeedback(isCorrect, question.feedback);

            // Colorer les r√©ponses
            styleOptions(isCorrect, index);
        }

        // S√©lection pour Choix Multiples (CB)
        function selectAnswerCB(index, buttonEl) {
            // Ajouter ou retirer l'index de la s√©lection
            const selectionIndex = userSelection.indexOf(index);
            if (selectionIndex > -1) {
                userSelection.splice(selectionIndex, 1);
                buttonEl.classList.remove('option-selected');
            } else {
                userSelection.push(index);
                buttonEl.classList.add('option-selected');
            }
        }

        // Validation pour Choix Multiples (CB)
        function validateAnswersCB() {
            const question = quizData[currentQuestionIndex];

            // Trier les deux tableaux pour les comparer
            const sortedSelection = [...userSelection].sort((a, b) => a - b);
            const sortedCorrect = [...question.correct].sort((a, b) => a - b);

            const isCorrect = JSON.stringify(sortedSelection) === JSON.stringify(sortedCorrect);

            if (isCorrect) {
                score++;
                updateScoreboard();
            }

            // D√©sactiver tous les boutons
            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-blue-50', 'hover:border-blue-400', 'option-selected');
            });

            // Afficher le feedback
            showFeedback(isCorrect, question.feedback);

            // Cacher le bouton Valider
            validateBtn.classList.add('hidden');
            multiSelectHint.classList.add('hidden');

            // Colorer les r√©ponses
            styleOptions(isCorrect);
        }

        // Logique de coloration (commune √† MC et CB)
        function styleOptions(isOverallCorrect, selectedIndex = -1) {
            const question = quizData[currentQuestionIndex];
            const allOptions = Array.from(optionsContainer.children);

            allOptions.forEach((btn, index) => {
                const isCorrectAnswer = question.correct.includes(index);
                const isSelected = (question.type === 'mc') ? (index === selectedIndex) : userSelection.includes(index);

                if (isCorrectAnswer) {
                    // Bonne r√©ponse
                    btn.className = "w-full p-4 rounded-lg border-2 border-green-500 bg-green-50 text-gray-900 text-left";
                } else if (isSelected && !isCorrectAnswer) {
                    // Mauvaise r√©ponse s√©lectionn√©e
                    btn.className = "w-full p-4 rounded-lg border-2 border-red-500 bg-red-50 text-gray-900 text-left";
                } else {
                    // Option non s√©lectionn√©e (et non correcte)
                    btn.className = "w-full p-4 rounded-lg border-2 border-gray-300 text-gray-800 text-left opacity-70";
                }
            });
        }

        // Afficher le feedback
        function showFeedback(isCorrect, text) {
            feedbackContainer.classList.remove('hidden');
            feedbackText.innerText = text;

            if (isCorrect) {
                feedbackContainer.className = "mt-6 p-5 rounded-lg bg-green-50";
                feedbackIcon.innerHTML = checkIcon;
                feedbackTitle.innerText = "Bonne r√©ponse !";
                feedbackTitle.className = "text-lg font-bold text-green-800";
            } else {
                feedbackContainer.className = "mt-6 p-5 rounded-lg bg-red-50";
                feedbackIcon.innerHTML = crossIcon;
                feedbackTitle.innerText = "Oups ! Voici l'explication :";
                feedbackTitle.className = "text-lg font-bold text-red-800";
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');

            finalScore.innerText = score;
            const percentage = Math.round((score / quizData.length) * 100);

            let message = "";
            if (percentage < 40) {
                message = "C'est un bon d√©but ! Le plus important est d'avoir particip√© et d'apprendre. Chaque petit pas compte !";
            } else if (percentage < 80) {
                message = "Super score ! Vous ma√Ætrisez d√©j√† tr√®s bien les bases et les actions de LACM√â. Continuons ensemble !";
            } else {
                message = "Excellent ! Vous √™tes un v√©ritable expert de la strat√©gie RSE de LACM√â !";
            }
            finalMessage.innerText = message;

            // Envoyer les donn√©es au Google Sheet
            submitToGoogleSheet();
        }

        async function submitToGoogleSheet() {
            if (GOOGLE_SCRIPT_URL === 'VOTRE_URL_APPS_SCRIPT_ICI' || GOOGLE_SCRIPT_URL === '') {
                submitStatus.innerText = "Configuration Google Sheet manquante.";
                submitStatus.className = "text-sm text-red-600 mb-8 font-medium";
                console.error("Veuillez renseigner GOOGLE_SCRIPT_URL dans le script.");
                return;
            }

            const formData = new FormData();
            formData.append('prenom', userPrenom);
            formData.append('nom', userNom);
            formData.append('email', userEmail);
            formData.append('score', score);

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.result === 'success') {
                    submitStatus.innerText = "Votre score a bien √©t√© enregistr√© !";
                    submitStatus.className = "text-sm text-green-600 mb-8 font-medium";
                } else {
                    throw new Error(result.message || 'Erreur inconnue');
                }
            } catch (error) {
                console.error('Erreur lors de l-envoi au Google Sheet:', error);
                submitStatus.innerText = "Erreur lors de l'enregistrement du score.";
                submitStatus.className = "text-sm text-red-600 mb-8 font-medium";
            }
        }


        function updateScoreboard() {
            currentScoreEl.innerText = `Score: ${score}`;
        }

        // --- √âcouteurs des √©v√©nements ---
        emailForm.addEventListener('submit', handleStartSubmit);
        nextBtn.addEventListener('click', nextQuestion);
        validateBtn.addEventListener('click', validateAnswersCB);

    </script>
</body>

</html>