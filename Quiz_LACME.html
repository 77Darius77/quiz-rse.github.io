<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz LACM√â: Pr√™ts pour la transition ?</title>
    <!-- Chargement de Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Chargement de la police Inter --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* D√©finition de la police Inter comme police par d√©faut */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style pour les options coch√©es (cases √† cocher) */
        .option-selected {
            background-color: #DBEAFE !important; /* bg-blue-100 */
            border-color: #3B82F6 !important; /* border-blue-500 */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden">
        
        <!-- √âcran d'Introduction --><div id="intro-screen" class="p-8 sm:p-12 text-center">
            <!-- Logo LACM√â --><img src="https://cheval-partenaire.fr/wp-content/uploads/2017/11/lacme_logo-1024x153.png" alt="Logo LACM√â" class="mx-auto mb-6 max-h-20 sm:max-h-24 object-contain">
            
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800 mb-4">Quiz LACM√â: Pr√™ts pour la transition ?</h1>
            <p class="text-lg text-gray-700 mb-4">
                Bienvenue √† vous cher collaborateur de LACM√â ! üëã
            </p>
            <p class="text-lg text-gray-700 mb-6">
                Ce quiz ludique est une excellente occasion de tester et d'enrichir vos connaissances sur les enjeux environnementaux qui nous concernent tous.
            </p>
            <p class="text-base text-gray-600 mb-6 font-medium">
                Attention : pour certaines questions, plusieurs r√©ponses peuvent √™tre exactes. Cochez-les toutes pour marquer plus de points ! üòâ
            </p>

            <!-- Formulaire d'Email -->
            <form id="email-form" class="mt-8 text-left max-w-md mx-auto">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="prenom" class="block text-sm font-medium text-gray-700 mb-2">Pr√©nom :</label>
                        <input type="text" id="prenom-input" name="prenom" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Votre pr√©nom" required>
                    </div>
                    <div>
                        <label for="nom" class="block text-sm font-medium text-gray-700 mb-2">Nom :</label>
                        <input type="text" id="nom-input" name="nom" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Votre nom" required>
                    </div>
                </div>

                <div class="mt-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email :</label>
                    <input type="email" id="email-input" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="votre.email@lacme.com" required>
                </div>
                
                <p id="email-error" class="text-red-600 text-sm mt-2 hidden">Veuillez remplir tous les champs (email valide).</p>
                
                <button id="start-btn" type="submit" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 px-12 rounded-lg text-lg hover:bg-blue-700 transition-all shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300">
                    Lan√ßons le d√©fi !
                </button>
            </form>

        </div>

        <!-- √âcran du Quiz --><div id="quiz-screen" class="hidden p-8 sm:p-12">
            <!-- Barre de progression --><div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span id="question-counter" class="text-sm font-medium text-blue-700">Question 1 / 10</span>
                    <span id="current-score" class="text-sm font-medium text-gray-600">Score: 0</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 10%"></div>
                </div>
            </div>

            <!-- Contenu de la question --><div class="mb-4 min-h-[100px]">
                <p id="question-text" class="text-xl sm:text-2xl font-semibold text-gray-900">Chargement de la question...</p>
                <p id="multi-select-hint" class="text-sm text-gray-500 italic mt-2 hidden">Plusieurs r√©ponses sont possibles !</p>
            </div>

            <!-- Options de r√©ponse --><div id="options-container" class="grid grid-cols-1 gap-4">
                <!-- Les options seront inject√©es ici par JS --></div>

            <!-- Bouton de validation (pour les cases √† cocher) --><button id="validate-btn" class="hidden w-full mt-6 bg-green-600 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-green-700 transition-all shadow-lg focus:outline-none focus:ring-4 focus:ring-green-300">
                Valider mes r√©ponses
            </button>

            <!-- Feedback --><div id="feedback-container" class="hidden mt-6 p-5 rounded-lg">
                <div class="flex items-start">
                    <div id="feedback-icon" class="flex-shrink-0">
                        <!-- SVG (check ou X) inject√© par JS --></div>
                    <div class="ml-4">
                        <h3 id="feedback-title" class="text-lg font-bold"></h3>
                        <p id="feedback-text" class="mt-2 text-base"></p>
                        <button id="next-btn" class="mt-4 bg-gray-800 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-900 transition-all focus:outline-none focus:ring-4 focus:ring-gray-300">
                            Question suivante
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âcran des R√©sultats --><div id="results-screen" class="hidden p-8 sm:p-12 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-800 mb-4">Quiz termin√© !</h1>
            <p class="text-lg text-gray-700 mb-6">Votre score final est de :</p>
            <div class="my-8">
                <span id="final-score" class="text-7xl font-bold text-blue-600">0</span>
                <span class="text-3xl font-semibold text-gray-500">/ 10</span>
            </div>
            <p id="final-message" class="text-lg text-gray-800 mb-10 px-4">Message de f√©licitations...</p>
            
            <p class="text-base text-gray-600 mb-2">
                Merci pour votre participation ! Chaque question est une √©tape de plus vers une entreprise plus responsable.
            </p>
            
            <!-- Statut de l'enregistrement -->
            <p id="submit-status" class="text-sm text-gray-500 mb-8 italic">Enregistrement de votre score...</p>

            <button id="restart-btn" class="w-full sm:w-auto bg-blue-600 text-white font-bold py-3 px-12 rounded-lg text-lg hover:bg-blue-700 transition-all shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300">
                Recommencer le Quiz
            </button>
        </div>

    </div>

    <script>
        // --- IMPORTANT ---
        // Collez ici l'URL de votre Web App Google Apps Script
        // Suivez les instructions du fichier "instructions_googlesheet.md"
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxg0xpJMksniiklKHptUwvWewF2EXK8ApZ2-F-7LgTd4y-HfBlMlfphEtNwJJDeu90VmA/exec';
        // -----------------


        // --- Donn√©es du Quiz ---
        const quizData = [
            {
                question: "Comment un enjeu environnemental (ex: la pollution plastique) devient-il un probl√®me public majeur ?",
                type: "mc", // mc = multiple choice (choix unique)
                options: [
                    "Automatiquement, d√®s qu'un scientifique publie une √©tude.",
                    "Uniquement si les politiques s'en emparent pour les √©lections.",
                    "Par √©tapes : alerte (scientifiques, ONG), prise de conscience du public (m√©dias) et enfin action politique/l√©gislative."
                ],
                correct: [2], // Index de la bonne r√©ponse
                feedback: "Exact ! Une question environnementale devient un probl√®me public par un processus complexe, impliquant de nombreux acteurs (ONG, experts, m√©dias, citoyens...) jusqu'√† son inscription √† l'agenda politique."
            },
            {
                question: "Au sein de notre PME, qui est (ou devrait √™tre) impliqu√© dans la transition √©cologique ?",
                type: "mc",
                options: [
                    "Uniquement la Direction, qui fixe la strat√©gie.",
                    "Seulement le responsable HSE / RSE.",
                    "Absolument tout le monde, de l'atelier au bureau."
                ],
                correct: [2],
                feedback: "C'est l'affaire de tous ! La transition √©cologique mobilise une grande diversit√© d'acteurs. Dans l'entreprise, chaque poste a un r√¥le √† jouer, des achats √† la production, en passant par l'administratif."
            },
            {
                question: "Pourquoi la lutte contre le r√©chauffement climatique doit-elle se faire √† la fois localement (chez nous) et globalement (au niveau des √âtats) ?",
                type: "cb", // cb = checkbox (choix multiples)
                options: [
                    "Parce que le climat est un \"bien commun\" mondial.",
                    "Parce que les actions locales (ex: isoler un b√¢timent) et globales (ex: accord international) sont compl√©mentaires.",
                    "Parce que l'√©chelle locale est la seule qui compte vraiment.",
                    "Parce que l'√©chelle globale est trop lente et inefficace."
                ],
                correct: [0, 1],
                feedback: "Tout √† fait ! Le climat est un bien commun qui ne conna√Æt pas les fronti√®res. Les actions locales (isolation, tri, circuits courts) sont essentielles, mais elles doivent √™tre soutenues par des cadres nationaux et internationaux pour √™tre pleinement efficaces."
            },
            {
                question: "En tant que PME en Sarthe, quelle action concr√®te peut avoir un impact significatif ?",
                type: "mc",
                options: [
                    "Installer une fontaine √† eau pour remplacer les bouteilles plastiques.",
                    "Optimiser les tourn√©es de livraison pour r√©duire la consommation de carburant.",
                    "Mettre en place le tri du papier au bureau.",
                    "Toutes ces actions sont utiles et leur impact combin√© est significatif."
                ],
                correct: [3],
                feedback: "Bravo ! C'est la somme de toutes ces actions qui fait la diff√©rence. L'optimisation des tourn√©es a souvent un gros impact (CO2 et financier), mais le tri et la r√©duction du plastique sont aussi cruciaux pour la RSE."
            },
            {
                question: "Dans la \"th√©orie √©conomique\", le r√©chauffement climatique est une \"externalit√© n√©gative\". Qu'est-ce que √ßa veut dire en simple ?",
                type: "mc",
                options: [
                    "Un co√ªt que l'on ne peut pas calculer.",
                    "Une cons√©quence n√©gative (ex: pollution) d'une activit√© √©conomique, dont le co√ªt n'est pas pay√© par le pollueur (mais par la soci√©t√©).",
                    "Un probl√®me qui vient de l'ext√©rieur de l'entreprise."
                ],
                correct: [1],
                feedback: "C'est exactement √ßa ! C'est une cons√©quence (n√©gative) de l'activit√© humaine qui affecte d'autres personnes (co√ªts de sant√©, d√©g√¢ts climatiques...) sans √™tre prise en compte dans le prix de vente. Les outils √©cologiques visent √† \"internaliser\" ce co√ªt."
            },
            {
                question: "Une r√©glementation √©cologique (ex: interdire les sacs plastique √† usage unique) repose principalement sur :",
                type: "mc",
                options: [
                    "L'incitation (ex: une subvention pour acheter un sac r√©utilisable)",
                    "La contrainte (une interdiction ou une obligation l√©gale)",
                    "La communication (faire une campagne de publicit√©)"
                ],
                correct: [1],
                feedback: "En effet. La r√©glementation IMPOSE des normes ou des interdictions. C'est un outil bas√© sur la contrainte, compl√©mentaire des outils bas√©s sur l'incitation (taxes, subventions, march√© carbone)."
            },
            {
                question: "Les \"petits gestes\" individuels (trier ses d√©chets, √©teindre sa lumi√®re) sont-ils suffisants pour relever le d√©fi climatique ?",
                type: "mc",
                options: [
                    "Oui, si tout le monde s'y met, cela suffira.",
                    "Non, ils sont inutiles, seule l'action des √âtats et des grosses industries compte.",
                    "Non, ils sont INDISPENSABLES mais pas suffisants. Ils doivent √™tre compl√©t√©s par des actions collectives et politiques fortes."
                ],
                correct: [2],
                feedback: "C'est la r√©ponse la plus juste. Les gestes individuels sont essentiels (ils cr√©ent une culture, un engagement) mais la transformation √©cologique n√©cessite aussi des politiques publiques, des innovations et l'engagement de TOUS les acteurs (dont les entreprises)."
            },
            {
                question: "Quels sont les r√¥les du march√© des \"quotas d'√©missions de CO‚ÇÇ\" (ou \"permis √† polluer\") ?",
                type: "cb",
                options: [
                    "Fixer un plafond global d'√©missions √† ne pas d√©passer.",
                    "Inciter les entreprises √† innover pour √©mettre moins de CO‚ÇÇ (car √©mettre co√ªte de l'argent).",
                    "Permettre de r√©partir les efforts de r√©duction l√† o√π ils sont le moins co√ªteux.",
                    "Donner un droit illimit√© de polluer."
                ],
                correct: [0, 1, 2],
                feedback: "Excellent ! Cet outil fixe un plafond global (l'objectif) et utilise le march√© pour inciter les entreprises √† r√©duire leurs √©missions ou √† innover, tout en leur laissant une certaine flexibilit√© pour trouver les solutions les plus efficaces."
            },
            {
                question: "Concr√®tement, la transition √©cologique pour une PME, c'est surtout...",
                type: "mc",
                options: [
                    "Une source de co√ªts et de contraintes suppl√©mentaires.",
                    "Seulement une question d'image de marque pour attirer les clients.",
                    "Une contrainte, mais aussi un levier d'innovation, d'√©conomies et d'attractivit√© (clients, talents...)."
                ],
                correct: [2],
                feedback: "C'est la vision moderne ! Si la transition demande des efforts, elle est aussi un formidable moteur pour innover (√©co-conception), faire des √©conomies (√©nergie, mati√®res), f√©d√©rer les √©quipes et r√©pondre aux attentes des clients et des futurs employ√©s."
            },
            {
                // Question "clin d'oeil" locale
                question: "La Sarthe est r√©put√©e (entre autres !) pour son agroalimentaire. Comment ce secteur peut-il innover pour l'√©cologie ?",
                type: "cb",
                options: [
                    "En d√©veloppant les circuits d'approvisionnement locaux.",
                    "En travaillant sur des emballages 100% recyclables ou compostables.",
                    "En valorisant les \"co-produits\" (d√©chets) en √©nergie (m√©thanisation) ou en alimentation animale.",
                    "En r√©duisant sa consommation d'eau et d'√©nergie."
                ],
                correct: [0, 1, 2, 3],
                feedback: "Toutes ces r√©ponses sont bonnes ! L'agroalimentaire a de nombreux leviers : circuits courts, √©co-conception des emballages, √©conomie circulaire (valorisation des d√©chets) et sobri√©t√© √©nerg√©tique. C'est un secteur cl√© de la transition !"
            }
        ];

        // --- √âl√©ments du DOM ---
        const introScreen = document.getElementById('intro-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');

        const emailForm = document.getElementById('email-form');
        const emailInput = document.getElementById('email-input');
        const emailError = document.getElementById('email-error');
        const nomInput = document.getElementById('nom-input'); // Ajout
        const prenomInput = document.getElementById('prenom-input'); // Ajout
        
        const restartBtn = document.getElementById('restart-btn');
        const nextBtn = document.getElementById('next-btn');
        const validateBtn = document.getElementById('validate-btn');

        const questionCounter = document.getElementById('question-counter');
        const currentScoreEl = document.getElementById('current-score');
        const progressBar = document.getElementById('progress-bar');
        const questionText = document.getElementById('question-text');
        const multiSelectHint = document.getElementById('multi-select-hint');
        const optionsContainer = document.getElementById('options-container');

        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');

        const finalScore = document.getElementById('final-score');
        const finalMessage = document.getElementById('final-message');
        const submitStatus = document.getElementById('submit-status');

        // Ic√¥nes pour le feedback
        const checkIcon = `
            <svg class="h-8 w-8 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>`;
        const crossIcon = `
            <svg class="h-8 w-8 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>`;

        // --- √âtat du Quiz ---
        let currentQuestionIndex = 0;
        let score = 0;
        let userSelection = []; // Pour les questions √† choix multiples (cb)
        let userEmail = "";
        let userNom = ""; // Ajout
        let userPrenom = ""; // Ajout

        // --- Fonctions ---

        function handleStartSubmit(event) {
            event.preventDefault();
            const email = emailInput.value;
            const nom = nomInput.value; // Ajout
            const prenom = prenomInput.value; // Ajout
            
            if (email && email.includes('@') && nom && prenom) { // Validation simple
                userEmail = email;
                userNom = nom; // Ajout
                userPrenom = prenom; // Ajout
                emailError.classList.add('hidden');
                startQuiz();
            } else {
                emailError.innerText = "Veuillez remplir tous les champs (email valide)." // Message d'erreur mis √† jour
                emailError.classList.remove('hidden');
            }
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userSelection = [];
            introScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            loadQuestion();
            updateScoreboard();
        }
        
        function restartQuiz() {
            // Remet le quiz √† l'√©cran d'introduction
            resultsScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            introScreen.classList.remove('hidden');
            emailInput.value = ""; // Vider l'email
            nomInput.value = ""; // Vider le nom
            prenomInput.value = ""; // Vider le pr√©nom
            userEmail = "";
            userNom = ""; // Ajout
            userPrenom = ""; // Ajout
            submitStatus.innerText = "Enregistrement de votre score..."; // R√©initialiser le statut
            submitStatus.className = "text-sm text-gray-500 mb-8 italic";
        }


        function loadQuestion() {
            // R√©initialiser
            userSelection = [];
            feedbackContainer.classList.add('hidden');
            validateBtn.classList.add('hidden');
            multiSelectHint.classList.add('hidden'); // Cacher l'indice par d√©faut
            optionsContainer.innerHTML = ''; // Vider les options pr√©c√©dentes

            const question = quizData[currentQuestionIndex];
            questionText.innerText = question.question;

            // Mise √† jour de la progression
            questionCounter.innerText = `Question ${currentQuestionIndex + 1} / ${quizData.length}`;
            progressBar.style.width = `${((currentQuestionIndex + 1) / quizData.length) * 100}%`;

            // Cr√©er les boutons d'option
            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.innerHTML = `<span class="font-medium">${option}</span>`;
                optionBtn.className = "w-full p-4 rounded-lg border-2 border-gray-300 text-gray-800 text-left transition-all duration-150 hover:bg-blue-50 hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-300";
                optionBtn.dataset.index = index;

                if (question.type === 'mc') {
                    optionBtn.onclick = () => selectAnswerMC(index, optionBtn);
                } else { // type === 'cb'
                    optionBtn.onclick = () => selectAnswerCB(index, optionBtn);
                }
                optionsContainer.appendChild(optionBtn);
            });

            // Afficher le bouton Valider et l'indice pour les 'cb'
            if (question.type === 'cb') {
                validateBtn.classList.remove('hidden');
                multiSelectHint.classList.remove('hidden');
            }
        }

        // S√©lection pour Choix Unique (MC)
        function selectAnswerMC(index) {
            const question = quizData[currentQuestionIndex];
            const isCorrect = question.correct[0] === index;

            if (isCorrect) {
                score++;
                updateScoreboard();
            }

            // D√©sactiver tous les boutons
            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-blue-50', 'hover:border-blue-400');
            });
            
            // Afficher le feedback
            showFeedback(isCorrect, question.feedback);

            // Colorer les r√©ponses
            styleOptions(isCorrect, index);
        }

        // S√©lection pour Choix Multiples (CB)
        function selectAnswerCB(index, buttonEl) {
            // Ajouter ou retirer l'index de la s√©lection
            const selectionIndex = userSelection.indexOf(index);
            if (selectionIndex > -1) {
                userSelection.splice(selectionIndex, 1);
                buttonEl.classList.remove('option-selected');
            } else {
                userSelection.push(index);
                buttonEl.classList.add('option-selected');
            }
        }

        // Validation pour Choix Multiples (CB)
        function validateAnswersCB() {
            const question = quizData[currentQuestionIndex];
            
            // Trier les deux tableaux pour les comparer
            const sortedSelection = [...userSelection].sort((a, b) => a - b);
            const sortedCorrect = [...question.correct].sort((a, b) => a - b);

            const isCorrect = JSON.stringify(sortedSelection) === JSON.stringify(sortedCorrect);

            if (isCorrect) {
                score++;
                updateScoreboard();
            }

            // D√©sactiver tous les boutons
            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('hover:bg-blue-50', 'hover:border-blue-400', 'option-selected');
            });

            // Afficher le feedback
            showFeedback(isCorrect, question.feedback);

            // Cacher le bouton Valider
            validateBtn.classList.add('hidden');
            multiSelectHint.classList.add('hidden');

            // Colorer les r√©ponses
            styleOptions(isCorrect);
        }

        // Logique de coloration (commune √† MC et CB)
        function styleOptions(isOverallCorrect, selectedIndex = -1) {
            const question = quizData[currentQuestionIndex];
            const allOptions = Array.from(optionsContainer.children);

            allOptions.forEach((btn, index) => {
                const isCorrectAnswer = question.correct.includes(index);
                const isSelected = (question.type === 'mc') ? (index === selectedIndex) : userSelection.includes(index);

                if (isCorrectAnswer) {
                    // Bonne r√©ponse
                    btn.className = "w-full p-4 rounded-lg border-2 border-green-500 bg-green-50 text-gray-900 text-left";
                } else if (isSelected && !isCorrectAnswer) {
                    // Mauvaise r√©ponse s√©lectionn√©e
                    btn.className = "w-full p-4 rounded-lg border-2 border-red-500 bg-red-50 text-gray-900 text-left";
                } else {
                    // Option non s√©lectionn√©e (et non correcte)
                    btn.className = "w-full p-4 rounded-lg border-2 border-gray-300 text-gray-800 text-left opacity-70";
                }
            });
        }

        // Afficher le feedback
        function showFeedback(isCorrect, text) {
            feedbackContainer.classList.remove('hidden');
            feedbackText.innerText = text;

            if (isCorrect) {
                feedbackContainer.className = "mt-6 p-5 rounded-lg bg-green-50";
                feedbackIcon.innerHTML = checkIcon;
                feedbackTitle.innerText = "Bonne r√©ponse !";
                feedbackTitle.className = "text-lg font-bold text-green-800";
            } else {
                feedbackContainer.className = "mt-6 p-5 rounded-lg bg-red-50";
                feedbackIcon.innerHTML = crossIcon;
                feedbackTitle.innerText = "Oups ! Voici l'explication :";
                feedbackTitle.className = "text-lg font-bold text-red-800";
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');

            finalScore.innerText = score;
            const percentage = Math.round((score / quizData.length) * 100);
            
            let message = "";
            if (percentage < 40) {
                message = "C'est un bon d√©but ! Le plus important est d'avoir particip√© et d'apprendre. Chaque petit pas compte !";
            } else if (percentage < 80) {
                message = "Super score ! Vous ma√Ætrisez d√©j√† tr√®s bien les bases de ces enjeux. Continuons ensemble !";
            } else {
                message = "Excellent ! Vous √™tes en mesure de devenir un v√©ritable ambassadeur de la transition √©cologique pour l'entreprise !";
            }
            finalMessage.innerText = message;

            // Envoyer les donn√©es au Google Sheet
            submitToGoogleSheet(); // Plus besoin d'arguments, on utilise les variables globales
        }
        
        async function submitToGoogleSheet() {
            if (GOOGLE_SCRIPT_URL === 'VOTRE_URL_APPS_SCRIPT_ICI' || GOOGLE_SCRIPT_URL === '') {
                submitStatus.innerText = "Configuration Google Sheet manquante.";
                submitStatus.className = "text-sm text-red-600 mb-8 font-medium";
                console.error("Veuillez renseigner GOOGLE_SCRIPT_URL dans le script.");
                return;
            }

            const formData = new FormData();
            formData.append('prenom', userPrenom); // Ajout
            formData.append('nom', userNom); // Ajout
            formData.append('email', userEmail);
            formData.append('score', score); // 'score' est d√©j√† une variable globale

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();

                if (result.result === 'success') {
                    submitStatus.innerText = "Votre score a bien √©t√© enregistr√© !";
                    submitStatus.className = "text-sm text-green-600 mb-8 font-medium";
                } else {
                    throw new Error(result.message || 'Erreur inconnue');
                }
            } catch (error) {
                console.error('Erreur lors de l-envoi au Google Sheet:', error);
                submitStatus.innerText = "Erreur lors de l'enregistrement du score.";
                submitStatus.className = "text-sm text-red-600 mb-8 font-medium";
            }
        }


        function updateScoreboard() {
            currentScoreEl.innerText = `Score: ${score}`;
        }

        // --- √âcouteurs d'√©v√©nements ---
        emailForm.addEventListener('submit', handleStartSubmit);
        restartBtn.addEventListener('click', restartQuiz);
        nextBtn.addEventListener('click', nextQuestion);
        validateBtn.addEventListener('click', validateAnswersCB);

    </script>
</body>
</html>

